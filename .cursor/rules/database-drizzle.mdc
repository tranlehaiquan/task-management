---
globs: apps/**/src/**/*.ts,packages/database/**
description: How to use the shared Database package (Drizzle ORM) across services
---

# Database (Drizzle ORM) Usage

- **Shared package**: Use the database code from [packages/database/src/index.ts](mdc:packages/database/src/index.ts), [packages/database/src/database.module.ts](mdc:packages/database/src/database.module.ts), and [packages/database/src/database.service.ts](mdc:packages/database/src/database.service.ts).
- **Schemas**: Located in [packages/database/src/schema](mdc:packages/database/src/schema/index.ts). Import schema objects from the package entry point rather than relative file paths in apps.
- **Migrations**: Managed in [packages/database/migrations](mdc:packages/database/migrations/0000_mute_kronos.sql) with config [packages/database/drizzle.config.ts](mdc:packages/database/drizzle.config.ts).

Guidelines:

- Import `DatabaseModule` into your Nest module to access the database via DI.
- Encapsulate queries in services. Keep controllers free of persistence logic.
- Prefer typed queries using schema exports; avoid raw SQL where possible.
- When needed, use transactions via the shared `DatabaseService` abstraction.
